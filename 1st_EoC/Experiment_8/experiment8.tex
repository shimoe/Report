
\documentclass[11pt,a4paper]{jsarticle}
\usepackage[dvips]{graphicx}
\usepackage{listings}

\setcounter{page}{0}

\renewcommand{\lstlistingname}{ソースコード}

\lstset{
  basicstyle = {\ttfamily \small},
  frame = trBL,
  numbers = left,
  numberstyle = {\ttfamily \small},
  breaklines = true,
}

%
\begin{document}

\title{制御工学実験II \\ PICマイコンを用いた2進数表示回路の作製}
\author{提出者 \\ 14104064 下松八重　宏太 \\ \\ 共同実験者 \\ 14101028 梶野　翔平 \\ 14104092 中島　美香 \\ 16104311 北山　拓夢 \\ 13104119 廣瀬　直人}
\date{実験日  \\ 2016年5月24日 \\ 2016年5月31日 \\ 2016年6月7日 \\ 2016年6月14日 \\  提出日 \\ \today}



\maketitle
\thispagestyle{empty}
\newpage


\section{目的}
これまでに修得した電子回路・論理回路の基本的な知識をどのくらい実践的に使用できるかを，PIC（Peripheral Interface Controller）マイコンを用いた実験により確かめる．PICマイコンを用いた2進数表示回路の製作において，実際のものづくりに必要なハードウェア技術及びソフトウェア技術をどのように融合させて使うのかを自習形式で学ぶ．

\section{原理}
\subsection{ハードウェア}
本実験では，8個の発光ダイオード（LED:Light Emitting Diode）を使用して，LEDの点滅による2進数表現の回路を製作する．この回路は，PIC（PIC16F84A）を中心として，LEDの点滅状態を設定するスイッチ，LED回路，PICクロック発振機，電源回路から構成されている．ここで主に使用されている電子部品は（a）抵抗，（b）コンデンサ，（c）3端子レギュレータである．
\begin{description}
 \item[(a)] 抵抗器　\\
	    抵抗器は電圧・電流を制御する部品である．本実験で制作する回路で使われている抵抗器は２種類ある．それぞれ，電流制限抵抗とプルアップ抵抗である．
 \item[(b)] コンデンサ \\
	    コンデンサは直流電流に対しては電荷を蓄える働きを，交流電流に対しては周波数により抵抗値の変わるリアクタンスとして機能する．高周波にはセラミックコンデンサを，低周波には電解コンデンサを使用する．本実験では平滑コンデンサ，発振防止コンデンサおよびバイパスコンデンサとして使われている．平滑コンデンサとバイパスコンデンサは電圧の変動を吸収し，安定した電圧を維持する．発振防止コンデンサは３端子レギュレータの前後に必ずつける部品である．
 \item[(c)] ３端子レギュレータ \\
	    ３端子レギュレータは出力電圧を常に一定に保つ働きを持つ．本実験では入力電圧（12V）から希望する出力電圧（5V）を作るために用いられている．発振を防ぐために入力と出力端子の近くにコンデンサを配置する．
\end{description}

\subsection{ソフトウェア}
　本実験ではマイコン（PIC16F84A）にプログラムを書き込んで動作させる．このプログラムには主にI/O制御，時間制御，チャタリング回避機能が組み込まれている．プログラムをソースコード\ref{src1}に示す．
\begin{description}
 \item[(a)] I/O制御 \\
	    入力ピンに対してHighまたはLowの電圧を出力し，出力ピンに対してHighまたはLowの電圧のどちらが出力されているかを知り，制御する．
 \item[(b)] 時間制御 \\
	    ソフトウェアまたはマイコン自体が持つハードウェアにより時間を制御する．本実験では簡単なソフトウェアによって時間を生成する．
 \item[(c)] チャタリングの回避 \\
	    本実験では，マイコンと使用者のインターフェースとしてタクトスイッチを使用している．このような機械式のスイッチではスイッチを押す瞬間（100msec程度）にONとOFFが繰り返されるチャタリングと呼ばれる現象が生じる．短時間にONとOFFが繰り返されるためにカウンタ機能が誤作動を起こす原因となる．これはスイッチが押されてから10msec程度の待ち受け時間を空けて，再度スイッチが押されているかを判定することで回避出来る．
\end{description}

\lstinputlisting[caption = ２進数表示回路のプログラム,label = src1]{./src.txt}

\newpage

\section{実験方法}
本実験では，第１週にソフトウェア製作を行い，第２週〜第４週でハードウェア製作を行う．

\subsection{ソフトウェア製作}
 ソースコード\ref{src1}をMPLABを用いてアセンブルを行う．これによりHEXファイルが生成され，PICに書き込むデータとなる．このデータをPICのメモリに書き込むためにライタというツールを使用し，次の処理を行う．（通常，この処理はパソコンとPICライタソフトを用いて行う．）

\begin{enumerate}
 \item HEXファイルの内容を解釈して，PICのメモリアドレス及びデータを認識する
 \item PICをICSP（IN-Circuit Serial Programming）モードにするために$\overline{\rm{MCLR}}$に電圧（＋13V）を印加する．
 \item PICが受け取る電気信号に変換する．
 \item PICのICSPの手順に合わせてこれらのデータをPICに送信する．
 \item PICに書き込まれた内容をチェックする．
\end{enumerate}

\subsubsection{チャタリングの確認}
チャタリング現象を確認するために，チャタリングの待ち受け時間を変更して実験を行う．

\subsection{ハードウェア製作}
　本制作実験では各自で組み立て作業を行い，回路を完成する．それぞれの電子部品の確認を行い，特にLEDのアノード・カソードの向き（長いリード線がアノードでプラス側に接続する），コンデンサの極性，３端子レギュレータの出力・GND・入力などに注意する．回路図を図\ref{fig1}に示す．

\newpage

\begin{figure}[h]
 \begin{center}
  \begin{minipage}[t]{0.33\hsize}
   \begin{center}
    \includegraphics[scale = 0.7]{./picture/circuit1.eps}
    (a)部品面
   \end{center}
  \end{minipage}
  
 \begin{minipage}[t]{0.33\hsize}
  \begin{center}
   \includegraphics[scale = 0.7]{./picture/circuit2.eps}
   (b)ハンダ面
  \end{center}
 \end{minipage}
  
  \caption{(a)部品面と(b)ハンダ面の回路パターン図}
  \label{fig1}
 \end{center}
\end{figure}



\newpage
 \section{実験結果}
 　製作した回路の写真を図\ref{fig2}に示す．また，図\ref{fig2}はタクトスイッチを64回押した結果である．

\begin{figure}[bp]
 \begin{center}
  \includegraphics[scale = 0.1]{./picture/picture1.eps}
  \caption{製作した回路}
  \label{fig2}
 \end{center}
\end{figure}

  \subsection{チャタリングの確認}
  ソースコード\ref{src1}において，チャタリング現象を回避するための時間を設定しているのは54行目である．ソースコード\ref{src1}においては関数T10Mを呼びだして，10[msec]の時間を開けた後にスイッチの判別を行っている．この時間を1[msec],100[msec],500[msec],1[sec]に変更してカウント実験を行った． \\
　1[msec]のとき，タクトスイッチを１回しか押していないにも関わらず，カウントが２回進んだことがあった．これはチャタリング現象によるものと考えられる． \\
　100[msec]，500[msec]のときはこの現象は表れなかったが，変更した時間の間スイッチを押し続ける必要があったため，１回のカウントに必要な時間が長くなった．


\newpage
 \section{課題}
  \subsection{抵抗器の使われ方}
  抵抗器にはプルアップ抵抗とは逆にプルダウン抵抗が存在する．プルアップ抵抗はマイコンの入力に確実にHighを入力するための抵抗であるが，プルダウン抵抗はGND側に付けられ，マイコンの入力に確実にLOWにするための抵抗である．

  \subsection{アセンブリ言語}
   \subsubsection{MOVLW について}
   8ビットのデータをワーキングレジスタに上書きする．
   \subsubsection{MOVWF について}
   ワーキングレジスタの内容をレジスタファイルに上書きする．このとき，ワーキングレジスタの内容はそのままである．
   \subsubsection{MOVFW について}
   MOVFWは正式には採用されていない命令語である．働きとしてはファイルレジスタの内容をワーキングレジスタに上書きするものである．PICには指定の場所にデータをコピーするMOVFという命令語があり，MOVFを用いてファイルレジスタからワーキングレジスタにデータをコピー出来る．つまり，MOVFWとは（MOVF f, 0）と同じである．ここで，fはコピー元のレジスタアドレス，0はコピー先でこの場合はワーキングレジスタを示す．

  \subsection{3端子レギュレータについて}
   本実験で使用した3端子レギュレータ（78L05）の最大入力電圧・電流，出力電圧は以下の通りである．
    \begin{itemize}
     \item 最大入力電圧:30[V]
     \item 最大入力電流:100[mA]
     \item 出力電圧:5[V]
    \end{itemize}

  \subsection{割り込みについて}
  割り込みとは，プログラムにおいてある処理が実行中に他の処理を割りこませてそれを先に行わせる処理のことである．PICにおける割り込み処理としては入力の変化，タイマの周期ごとなどに割り込み処理が行われる．割り込み処理用のレジスタが存在し，その中でどのフラグが1になっているかを見ることで割り込みを発生させている．また，割り込みを行う時はコンピュータの状態を保存しておき，割り込み処理後に復元する．PICにおいてはワーキングレジスタ，ステータスレジスタ，プログラムカウンタの状態をメモリに保存しておく．

\end{document}








